function getNoCache(){return{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:0}}function getBaseContentHeaders(e){var t={};return e||(t=getNoCache()),t}function Event(){this._unnamedHandlers=[],this._namedHandlers={},this._parents={},this._globalParent}function createEventInterface(e){e.prototype.on=function(e,t,r,n){this._event&&this._event.on(e,t,r,n)},e.prototype.off=function(){this._event.off()},e.prototype.trigger=function(e){this._event.trigger(e)}}function doEventMixin(e,t){e&&t&&(e.on=function(e,r,n,i){t.on(e,r,n,i)},e.off=function(){t.off()},e.trigger=function(e){t.trigger(e)})}function Dispatcher(e){this._server=e,this._security,this._controllers=[]}function DispatcherServer(e){this._config=copyObjWithDefs(e,defaultConfig);var t=this._config.protocol||defaultHttp;this._dispatcher=new Dispatcher;var r=this,n=t.createServer(function(e,t){DoDispatch(r,e,t)}).listen(this._config.port);this._dispatcher.setSecurity(this._config.security),this._dispatcher.setServer(n)}function Controller(e){this._handlers=[];for(var t=0;t<e.length;t++)this._handlers[this._handlers.length]=e[t]}function getFullViewPath(e,t,r){var n=t.view.suffix[r]||t.view.suffix[0];return"/"+t.view.prefix+"/"+e+n}function loadFile(e,t,r,n,i){!i||i.isFileAccessible(e)?t?fs.readFile("."+e,function(e,i){e?(n["content-type"]=t,r.writeHead(404,n),r.end()):(n["content-type"]=t,r.writeHead(200,n),r.end(i))}):(n["content-type"]="text/html",r.writeHead(400,n),r.end()):doResponseDenied(r)}function doResponseDenied(e){e.writeHead(401,{"content-type":"text/html"}),e.end("Access Denied")}function DoDispatch(e,t,r){var n,i=e.getControllerCount(),o=!1,s=e.getSecurity(),a=getPathByRequest(t);if(e.getConfig().noCache===!1,!s||s.isMethodAccessible(t.method)&&s.isAccessible())try{for(var c=0;i>c&&!o;c++)n=e.getControllerByIndex(c),o=n.processHandler(t,r,e.getConfig());o||loadFile(a.path,getDefinitionType(a.pathExt),r,getBaseContentHeaders(e.getConfig().cache),s)}catch(l){if(!(l instanceof AccessDeniedError))throw l;doResponseDenied(r)}else doResponseDenied(r)}function getDefinitionType(e){var t="",r=fieldDefs[e];return r&&(t=r.contentType),t}function getPathByRequest(e){var t=url.parse(e.url,!0),r=queryString.unescape(t.pathname),n=path.extname(r);return"."==n[0]&&(n=n.substring(1)),{query:t.query,path:r,pathBase:path.basename(r),pathExt:n}}function doesHandlerMatchPath(e,t,r){e=(e||"").toLocaleLowerCase(),t=(t||"").toLocaleLowerCase();var n=removeFirstDelimiter(e,pathTerminator),i=removeFirstDelimiter(t,pathTerminator)||"",o=i.match(new RegExp("{.+?}","g"),"")||[],s={};n=n.split(pathTerminator),i=i.split(pathTerminator);for(var a=n.length==i.length,c=0,l={},h=0;h<n.length&&a;h++)if(a=i[h]==n[h],!a){if(a=void 0!==o[c]){var d=o[c];if(l[d])throw new Error("Paths that have duplicate named path variables are not allowed.");l[d]=!0,d=d.substring(1,d.length-1),s[d]=n[h]}c++}return r&&(r.variables=s),a}var cachedModules=[];cachedModules[1879]={exports:{}},function(e,t){var r={contentType:"image/jpeg"},n={ico:{contentType:"image/x-icon"},html:{contentType:"text/html"},js:{contentType:"text/javascript"},css:{contentType:"text/css"},json:{contentType:"application/json"},jpg:r,jpeg:r,png:{contentType:"image/png"},gif:{contentType:"image/gif"},ico:{contentType:"image/x-icon"}};t.getFields=function(){var e={};for(var t in n)e[t]={},e[t].contentType=n[t].contentType;return e}}.call(this,cachedModules[1879],cachedModules[1879].exports),cachedModules[4579]={exports:{}},function(e,t){function r(e,t,r,n){var i=[];if(t){for(var o=0;o<e.length;o++)if(e[o]||r){var s=t(e[o]);(!n||n(e,s))&&(i[i.length]=s)}}else for(var o=0;o<e.length;o++)if(e[o]||r){var s=e[o];(!n||n(e,s))&&(i[i.length]=s)}return i}function n(e,t){t=t||"",e=e||"";for(var r=t.length,n=!0,i=0;r>i&&n;i++)t[i]!=e[i]&&(n=!1);return n}function i(e,t){var r=e;return r&&n(r,t)&&(r=r.substring(t.length)),r}function o(e,t){var r;if(void 0!==e)if("object"==typeof e)if(e instanceof Array){r=[];var n;t=t instanceof Array?t:[];for(var i=e.length>t.length?e.length:t.length,s=0;i>s;s++)n=e[s],void 0===n&&(n=t[s]),n&&(r[s]=o(n,t[s]))}else{r={},t=t instanceof Object?t:{};var a,c={};for(var l in e)a=e[l],void 0===a&&(a=t[l]),c[l]=!0,r[l]=o(a,t[l]);for(var l in t)c[l]||(r[l]=o(t[l],t[l]))}else r=e||t;else void 0!==t&&(r=o(t,t));return r}function s(e,t){for(var r,n=-1,i=0,o=e.length-1,s=(i+o)/2;o>=i&&-1==n;)r=e[s],r>t?o=s-1:t>r?i=s+1:n=s,s=(i+o)/2;return n}t.isTerminatorAtStart=n,t.removeFirstDelimiter=i,t.copyObjWithDefs=o,t.cloneArray=r,t.binarySearch=s}.call(this,cachedModules[4579],cachedModules[4579].exports),cachedModules[406]={exports:{}},function(e,t){function r(e){e=void 0===e?"":e,e=e.toLocaleLowerCase()}function n(e,t){return e.indexOf(t)>-1}function i(e){this._rFiles,this._rHandlers,this._rHandlerMethods,this._isRestrictedCallbacks,e=e||{},e.restricted=e.restricted||h,e.isRestrictedCallbacks=e.isRestrictedCallbacks||h.isRestrictedCallbacks,this.setRestrictedFiles(e.restricted.files),this.setRestrictedMethods(e.restricted.handlersMethods),this.setRestrictedHandlers(e.restricted.handlers)}function o(e){this.name="AccessDenied",this.message=e||"Access Denied",this.stack=(new Error).stack}var s=cachedModules[4579].exports,a=s.cloneArray,c=s.binarySearch,l="SJV-all",h={restricted:{files:[],handlers:[],handlerMethods:[]},isAuthCallbacks:[]};i.prototype.isFileAccessible=function(e){return-1==c(this._rFiles,e)},i.prototype.isMethodAccessible=function(e){var t=!0;return e&&(e=e.toLocaleLowerCase(),t=-1==c(this._rHandlerMethods,e)),t},i.prototype.isHandlerAccessible=function(e){var t=!0;return e=e||{},e.path&&(e.method=e.method||l,t=-1==c(this._rHandlers[e.method.toLocaleLowerCase()],e.path.toLocaleLowerCase())),t},i.prototype.isAccessible=function(){for(var e=!1,t=0;t<this._isRestrictedCallbacks.length&&!e;t++)e=this._isRestrictedCallbacks[t]();return e},i.prototype.setRestrictedFiles=function(e){e=e||[],this._rFiles=a(e,r,!1,n),this._rFiles.sort()},i.prototype.setRestrictedMethods=function(e){e=e||[],this._rHandlerMethods=a(e,r,!1,n),this._rHandlerMethods.sort()},i.prototype.setRestrictedHandlers=function(e){e=e||[];for(var t,r,n,i=0;i<e.length;i++)t=e[i],t&&(r=t.method||l,r=r.toLocaleLowerCase(),n=t.path||"",n=n.toLocaleLowerCase(),n&&(this._rHandlers[r]&&(this._rHandlers[r]=[]),this._rHandlers[r][this._rHandlers[r].length]=n));for(var o in this._rHandlers)this._rHandlers[o].sort(function(e,t){var r=0;return e.path<t.path?r=-1:e.path>t.path&&(r=1),r})},i.prototype.setCustomRestrictions=function(e){e=e||[],this._isRestrictedCallbacks=a(e)},o.prototype=Object.create(Error.prototype),o.prototype.constructor=Error,t.getSecurity=function(e){return new i(e)},t.AccessDeniedError=o}.call(this,cachedModules[406],cachedModules[406].exports);var url=require("url"),queryString=require("querystring"),path=require("path"),fs=require("fs"),fieldDefs=cachedModules[1879].exports;fieldDefs=fieldDefs.getFields();var utilities=cachedModules[4579].exports,security=cachedModules[406].exports,removeFirstDelimiter=utilities.removeFirstDelimiter,copyObjWithDefs=utilities.copyObjWithDefs,globalEvent,AccessDeniedError=security.AccessDeniedError,defaultHttp=require("http"),defaultConfig={view:{exts:["html","htm"],suffix:[".html",".html"],prefix:"pages"},port:8080,cache:!1};Event.extractParameters=function(e,t,r){var n={};return"string"==typeof e?n.eventName=e:n.eventTarget=e,n.eventName||("string"==typeof t?n.eventName=t:n.eventHandler=t),n.eventHandler||(n.eventHandler=r),n.eventName&&(n.eventName=n.eventName.toLocaleLowerCase()),n},Event.prototype.on=function(e,t,r,n){var i=Event.extractParameters(e,t,r),o=i.eventName,s=i.eventTarget,a=i.eventHandler;if(s)this.on.call(s,o,a);else{if(o&&a){if(this._namedHandlers[o]||(this._namedHandlers[o]=[]),-1==this._namedHandlers.indexOf(a)){var c=this._namedHandlers[o].length;this._namedHandlers[o][c]=a}}else a&&this._unnamedHandlers.indexOf(a)&&(this._unnamedHandlers[this._unnamedHandlers.length]=a);n&&n!=this&&(o?this._parents[o]=n:this._globalParent=n)}},Event.prototype.trigger=function(e,t){if(e&&this._namedHandlers[e]){for(var r=this._namedHandlers[e],n=0;n<r.length;n++)r[n](this,t);this._parents[e]&&this._parents[e].trigger(e,t)}else for(var n=0;n<this._unnamedHandlers.length;n++)this._unnamedHandlers[n](this,t)},globalEvent=new Event,Dispatcher.prototype.addController=function(e){if(!(e instanceof Controller))throw new Error("Cannot add non controller objects to the dispatcher's list of controllers.");e&&-1==this._controllers.indexOf(e)&&(this._controllers[this._controllers.length]=e,globalEvent.on("beforeHandlerProcess",function(e,t){if(!this._security&&!this._security.isHandlerAccessible(t))throw new AccessDeniedError}))},Dispatcher.prototype.setSecurity=function(e){this._security=e},Dispatcher.prototype.getSecurity=function(){return this._security},Dispatcher.prototype.setServer=function(e){this._server=e},Dispatcher.prototype.getServer=function(e){this._server=e},Dispatcher.prototype.getControllerCount=function(){return this._controllers.length},Dispatcher.prototype.getControllerByIndex=function(e){return this._controllers[e]},DispatcherServer.prototype.getConfig=function(){return this._config},DispatcherServer.prototype.getControllerCount=function(){return this._dispatcher.getControllerCount()},DispatcherServer.prototype.getControllerByIndex=function(e){return this._dispatcher.getControllerByIndex(e)},DispatcherServer.prototype.addController=function(e){e&&this._dispatcher.addController(e)},DispatcherServer.prototype.setSecurity=function(e){this._dispatcher.setSecurity(e)},DispatcherServer.prototype.getSecurity=function(){return this._dispatcher.getSecurity()},Controller.prototype.processHandler=function(e,t,r){var n,i=!1,o=getPathByRequest(e),s={};r=r||defaultConfig;for(var a=0;a<this._handlers.length&&!i;a++)n=this._handlers[a],globalEvent.trigger("beforeHandlerProcess",{handler:{path:n.path,method:n.method}}),i=doesHandlerMatchPath(o.path,n.path,s)&&n.method==e.method;if(i){var c=(n.returnType||"").toLocaleLowerCase(),l=r.cache;if(void 0!==n.cache&&(l=n.cache),"string"==c||"viewname"==c){var h=n.process(e,t,s.variables)||"";if("string"!=typeof h)throw new Error("Return type not a string. The expected return type of the handler is a string.");var d=getFullViewPath(h,r,1);loadFile(d,getDefinitionType(o.pathExt),t,getBaseContentHeaders(l))}else if("object"==c)n.process(e,t,s.variables);else{var p=n.responseHeader||{};p.content=p.content||{};var u=getBaseContentHeaders(l);u["Cache-Control"]&&(p.content["Cache-Control"]=u["Cache-Control"],p.content.Pragma=u.Pragma,p.content.Expires=u.Expires),t.writeHead(p.code||200,p.content);var f=t.writeHead;t.writeHead=void 0,n.process(e,t,s.variables),t.writeHead=f,t.end()}}return i};var pathTerminator="/",dispatcherMap={};exports.getDispatcherServer=function(e,t){return(!dispatcherMap[e]||t)&&(dispatcherMap[e]=new DispatcherServer(t)),dispatcherMap[e]};var controllerMap={};exports.getController=function(e,t){return(!controllerMap[e]||config)&&(controllerMap[e]=new Controller(t)),controllerMap[e]};
//# sourceMappingURL=UGLIFY_SOURCE_MAP_TOKEN